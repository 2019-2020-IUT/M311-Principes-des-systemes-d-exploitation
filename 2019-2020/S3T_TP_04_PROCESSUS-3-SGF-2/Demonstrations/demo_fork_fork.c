/********************/
/*  demo_dup2 : ... */
/********************/
# include <stdio.h>
# include <fcntl.h>
# include <unistd.h>
#include <stdlib.h>

int main()
{ int res;
  int tp[2];
  pipe (tp);
  if ((res = fork()) ==-1) {perror ("fork1"); exit (1); } 
  else if (res != 0) // Pere
       { 
          if ((res = res = fork()) ==-1) {perror ("fork2"); exit (1); } 
          else if (res != 0)
               { // pere
                  execlp ("who", "who", NULL);
               } 
              else // Fils2
              { 
                 close (tp[0]);
                 dup2 (tp[1], 1);
                 execlp ("ls", "ls", "-la", NULL);
              } 
       }    
      else // Fils1
        {
           close (tp[1]);
           dup2 (tp[0], 0);
           execlp ("wc", "wc", "-l", NULL);
        }  
   return 0;
}
